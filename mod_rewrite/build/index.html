<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Demystifying mod_rewrite</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/hovercraft.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress" data-transition-duration="500"><div class="step" step="0" data-x="0" data-y="0"><h1 id="demystifying-mod-rewrite">Demystifying mod_rewrite</h1><p>Less magic, more science</p><p>Rich Bowen - <a href="mailto:rbowen@apache.org">rbowen@apache.org</a></p><p>@rbowen</p><p><a href="http://rcbowen.com/">http://rcbowen.com/</a></p><p>SLIDES ARE AT: <a href="http://tm3.org/rewritescale">http://tm3.org/rewritescale</a></p></div><div class="step" step="1" data-x="1600" data-y="0"><img src="images/voodoo.jpg" alt="" width="" height=""></img><p>Despite the tons of examples and docs, mod_rewrite is voodoo. Damned
cool voodoo, but still voodoo.</p><p>-- Brian Moore</p></div><div class="step" step="2" data-x="3200" data-y="0"><img src="images/wizard.gif" alt="" width="" height=""></img><p>And numerous websites offer mod_rewrite advice that is much more akin to
magic than science.</p></div><div class="step" step="3" data-x="4800" data-y="0"><img src="images/algebra.gif" alt="" width="" height=""></img><p>I'd like to show you that mod_rewrite is a clear, concise,
algebraic notation, not a magical incantation.</p></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="shameless-plug">Shameless Plug</h1><img src="images/book.jpg" alt="" width="" height=""></img><p><a href="http://drbacchus.com/books/rewrite">http://drbacchus.com/books/rewrite</a></p></div><div class="step" step="5" data-x="8000" data-y="0"><h1 id="regular-expressions">Regular Expressions</h1><img src="images/mre.jpg" alt="" width="" height=""></img><ul><li>Atomic description of text patterns</li><li>Start with a small vocabulary and work up</li><li>Essential building block of mod_rewrite syntax</li><li>PCRE</li></ul><div class="notes"><p>Mastering Regular Expressions, Jeffrey Friedl</p></div></div><div class="step" step="6" data-x="9600" data-y="0"><h1 id="id1">.</h1><ul><li>Wildcard character</li><li>Matches one "atom"</li><li>In mod_rewrite syntax, it matches a 'character'</li><li>Use . if you want to match a literal "."</li></ul></div><div class="step" step="7" data-x="11200" data-y="0"><h1 id="tangent">Tangent</h1><ul><li>'Character' vs 'Byte'</li></ul><img src="images/chinese.jpg" alt="" width="600px" height="507px"></img></div><div class="step" step="8" data-x="12800" data-y="0"><img src="images/axb.png" alt="" width="" height=""></img></div><div class="step" step="9" data-x="14400" data-y="0"><h1 id="id2">+/*/?</h1><ul><li>Repetition characters</li><li>Turns an atom into a molecule</li></ul></div><div class="step" step="10" data-x="16000" data-y="0"><h1 id="one-or-more">+ - One or more</h1><img src="images/a+.png" alt="" width="" height=""></img></div><div class="step" step="11" data-x="17600" data-y="0"><h1 id="zero-or-more">* - Zero or more</h1><ul><li>a* matches zero or more 'a' characters</li><li>a</li><li>aaaaa</li><li>Also matches "Fish", which contains zero 'a' characters</li></ul></div><div class="step" step="12" data-x="19200" data-y="0"><h1 id="id3">?</h1><ul><li>Makes a match optional</li><li>That is, matches zero or one</li></ul></div><div class="step" step="13" data-x="20800" data-y="0"><img src="images/colour.png" alt="" width="" height=""></img></div><div class="step" step="14" data-x="22400" data-y="0"><h1 id="and">^ and $</h1><ul><li>Anchors</li><li>Starts with</li><li>Ends with</li></ul></div><div class="step" step="15" data-x="24000" data-y="0"><img src="images/anchora.png" alt="" width="" height=""></img></div><div class="step" step="16" data-x="25600" data-y="0"><img src="images/anchora2.png" alt="" width="" height=""></img></div><div class="step" step="17" data-x="27200" data-y="0"><h1 id="id4">^$ and ^</h1><ul><li>^$ is a special case - matches empty string</li><li>starts with ends with (nothing between)</li><li>^ (all by itself) matches every string (including empty string)</li></ul></div><div class="step" step="18" data-x="28800" data-y="0"><h1 id="id5">( )</h1><ul><li>Turns several atoms into a molecule (grouping)</li><li>Can apply repetition characters to this molecule</li><li>(ab)+ matches "abababab"</li></ul></div><div class="step" step="19" data-x="30400" data-y="0"><h1 id="id6">( )</h1><ul><li>Also "captures"</li><li>The matched set of parentheses becomes $1</li><li>The next one $2, and so on</li><li>Examples in just a moment</li></ul></div><div class="step" step="20" data-x="32000" data-y="0"><h1 id="id7">[ ]</h1><ul><li>Character class</li><li>Match one of these things</li></ul></div><div class="step" step="21" data-x="33600" data-y="0"><img src="images/coat.png" alt="" width="" height=""></img></div><div class="step" step="22" data-x="35200" data-y="0"><h1 id="not">Not</h1><ul><li>Any regex can be negated in a RewriteRule or RewriteCond by putting a ! in front of it</li><li>A character class is negated with a ^</li></ul><pre class="highlight ">[^abc]</pre><p>Matches anything EXCEPT a, b, c</p></div><div class="step" step="23" data-x="36800" data-y="0"><h1 id="mod-rewrite">mod_rewrite</h1><ul><li>mod_rewrite uses regular expressions to match requests, and modify them in some way</li><li>(And a lot of other things)</li></ul></div><div class="step" step="24" data-x="38400" data-y="0"><h1 id="rewriterule">RewriteRule</h1><p>RewriteRule PATTERN TARGET</p></div><div class="step" step="25" data-x="40000" data-y="0"><h1 id="id8">RewriteRule</h1><p>RewriteRule <em>PATTERN</em> TARGET</p><p>If it matches <em>this</em></p></div><div class="step" step="26" data-x="41600" data-y="0"><h1 id="id9">RewriteRule</h1><p>RewriteRule PATTERN <em>TARGET</em></p><p>Do <em>this</em> instead</p></div><div class="step" step="27" data-x="43200" data-y="0"><h1 id="id10">RewriteRule</h1><p>RewriteRule PATTERN TARGET \
<em>[flags]</em></p><p>With some optional <em>tweaks</em></p></div><div class="step" step="28" data-x="44800" data-y="0"><img src="images/syntax_rewriterule.png" alt="" width="" height=""></img></div><div class="step" step="29" data-x="46400" data-y="0"><h1 id="syntax">Syntax</h1><p>RewriteRule <em>PATTERN</em> TARGET</p><ul><li><em>PATTERN</em> is a regular expression (usually)</li><li>Applied to the REQUEST_URI</li><li>That's everything after <a href="http://hostname">http://hostname</a></li><li>May be modified by context (eg, .htaccess files) or by earlier rewrite rules</li></ul></div><div class="step" step="30" data-x="48000" data-y="0"><h1 id="id11">Syntax</h1><p>RewriteRule <em>PATTERN</em> TARGET</p><ul><li><em>TARGET</em> is where you want it to go instead</li><li>File path, or URI, or something else, depending on context and flags</li></ul></div><div class="step" step="31" data-x="49600" data-y="0"><h1 id="examples">Examples</h1><pre class="highlight ">RewriteRule ^/images/(.*)\.jpg /pics/$1.gif [R=301]</pre></div><div class="step" step="32" data-x="51200" data-y="0"><h1 id="flags">Flags</h1><ul><li>Modify behavior of a RewriteRule</li><li>Default is to treat it as a file path relative to current location</li></ul></div><div class="step" step="33" data-x="52800" data-y="0"><h1 id="r">[R]</h1><ul><li>Forces an external redirect, optionally with the specified HTTP status code.</li><li>Issues a redirect header to the client - URL in browser changes</li></ul><pre class="highlight ">RewriteRule ^/images/(.*)\.jpg /pics/$1.gif [R=302]

RewriteRule products http://products.example.org/ [R=301]</pre><div class="notes"><p>302=temp, 301=permanent</p></div></div><div class="step" step="34" data-x="54400" data-y="0"><h1 id="pt">[PT]</h1><ul><li>Forces the resulting URI to be passed back to the URL mapping engine for processing of other URI-to-filename translators, such as Alias or Redirect.</li><li>Treat the target as a URI, processing it for URI-type things</li></ul><pre class="highlight ">RewriteRule ^/products/(.+?)/ /prod.php?$1 [PT,L]</pre></div><div class="step" step="35" data-x="56000" data-y="0"><h1 id="b">[B]</h1><ul><li>Escape non-alphanumeric characters <em>before</em> applying the transformation.</li><li>Preserves special characters in the URI through the rewriting process</li></ul></div><div class="step" step="36" data-x="57600" data-y="0"><h1 id="c">[C]</h1><ul><li>Rule is chained to the following rule. If the rule fails, the rule(s) chained to it will be skipped.</li><li>Use this when you need to do several transformations in a row as part of a single logical operation.</li></ul></div><div class="step" step="37" data-x="59200" data-y="0"><h1 id="co">[CO]</h1><ul><li>Sets a cookie in the client browser.</li></ul><pre class="highlight ">RewriteRule ^/index.html - CO=fontdoor:1:example.com</pre><ul><li>Full syntax is: CO=NAME:VAL:domain[:lifetime[:path[:secure[:httponly]]]]</li><li><em>-</em> as the target means "don't rewrite"</li></ul></div><div class="step" step="38" data-x="60800" data-y="0"><h1 id="dpi">[DPI]</h1><ul><li>Causes the PATH_INFO portion of the rewritten URI to be discarded.</li></ul></div><div class="step" step="39" data-x="62400" data-y="0"><h1 id="env">[ENV]</h1><ul><li>Causes an environment variable VAR to be set (to the value VAL if provided).</li><li>The form !VAR causes the environment variable VAR to be unset.</li></ul><pre class="highlight ">RewriteRule \.(png|gif|jpg)$ - [E=image:1]
CustomLog logs/access_log combined env=!image</pre><ul><li>Example: Don't log images</li></ul></div><div class="step" step="40" data-x="64000" data-y="0"><h1 id="f">[F]</h1><ul><li>Returns a 403 FORBIDDEN response to the client browser.</li></ul><pre class="highlight ">RewriteRule \.exe - [F]</pre></div><div class="step" step="41" data-x="65600" data-y="0"><h1 id="g">[G]</h1><ul><li>Returns a 410 GONE response to the client browser.</li><li>I've never actually used this flag.</li></ul></div><div class="step" step="42" data-x="67200" data-y="0"><h1 id="h">[H]</h1><ul><li>Causes the resulting URI to be sent to the specified Content-handler for processing.</li></ul><pre class="highlight ">RewriteRule ^(/source/.+\.php)s$ $1 [H=application/x-httpd-php-source]</pre><ul><li>Example causes .phps requests to be processed by PHP's syntax-highlighter</li></ul></div><div class="step" step="43" data-x="68800" data-y="0"><h1 id="l">[L]</h1><ul><li>Stop the rewriting process immediately and don't apply any more rules.</li><li>Probably doesn't do what you expect in per-directory and .htaccess context</li><li>(see also the END flag).</li></ul><pre class="highlight ">RewriteBase /
RewriteCond %{REQUEST_URI} !=/index.php
RewriteRule ^(.*) /index.php?req=$1 [L,PT]</pre></div><div class="step" step="44" data-x="70400" data-y="0"><h1 id="end">[END]</h1><ul><li>Stop the rewriting process immediately and don't apply any more rules.</li><li>Also prevents further execution of rewrite rules in per-directory and .htaccess context.</li><li>(Available in 2.3.9 and later)</li><li>Note that a rule issuing a REDIRECT to itself will still result in rules being re-run</li></ul></div><div class="step" step="45" data-x="72000" data-y="0"><h1 id="n">[N]</h1><ul><li>Re-run the rewriting process, starting again with the first rule, using the result of the ruleset so far as a starting point.</li></ul><pre class="highlight ">RewriteRule (.*)A(.*) $1B$2 [N]</pre><ul><li>Example - global search and replace of A with B, looping until there's no more As</li><li>Use [N=100] to limit to 100 iterations (2.4.8 and later)</li></ul></div><div class="step" step="46" data-x="73600" data-y="0"><h1 id="nc">[NC]</h1><ul><li>Makes the pattern comparison case-insensitive.</li></ul><pre class="highlight ">RewriteRule (.*\.(jpg|gif|png))$ http://images.example.com$1 [P,NC]</pre></div><div class="step" step="47" data-x="75200" data-y="0"><h1 id="ne">[NE]</h1><ul><li>Prevent mod_rewrite from applying hexcode escaping of special characters in the result of the rewrite. * Not to be confused with [B]</li></ul></div><div class="step" step="48" data-x="76800" data-y="0"><h1 id="ns">[NS]</h1><ul><li>Causes a rule to be skipped if the current request is an internal sub-request.</li></ul></div><div class="step" step="49" data-x="78400" data-y="0"><h1 id="p">[P]</h1><ul><li>Force the substitution URL to be internally sent as a proxy request.</li></ul><pre class="highlight ">RewriteRule (.*\.(jpg|gif|png))$ http://images.example.com$1 [P,NC]</pre><ul><li>Proxy to back-end image server</li></ul></div><div class="step" step="50" data-x="80000" data-y="0"><h1 id="qsa">[QSA]</h1><ul><li>Appends any query string from the original request URL to any query string created in the rewrite target.</li><li>That is, it preserves the user-submitted query string, in addition to the one you created</li></ul><pre class="highlight ">RewriteRule /pages/(.+) /page.php?page=$1 [QSA]</pre></div><div class="step" step="51" data-x="81600" data-y="0"><h1 id="qsd">[QSD]</h1><ul><li>Discard any query string attached to the incoming URI.</li></ul></div><div class="step" step="52" data-x="83200" data-y="0"><h1 id="s">[S]</h1><ul><li>Tells the rewriting engine to skip the next num rules if the current rule matches.</li><li>Like a GoTo statement for rewrite rules</li><li>Consider using &lt;If&gt; and &lt;Else&gt; instead</li></ul><pre class="highlight "># Is the request for a non-existent file?
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
# If so, skip these two RewriteRules
RewriteRule .? - [S=2]

RewriteRule (.*\.gif) images.php?$1
RewriteRule (.*\.html) docs.php?$1</pre></div><div class="step" step="53" data-x="84800" data-y="0"><h1 id="t">[T]</h1><ul><li>Force the MIME-type of the target file to be the specified type.</li></ul><pre class="highlight "># Serve .pl files as plain text
RewriteRule \.pl$ - [T=text/plain]</pre></div><div class="step" step="54" data-x="86400" data-y="0"><h1 id="htaccess-files">.htaccess files</h1><ul><li>.htaccess files are for local (per-directory) configuration</li><li>mod_rewrite assumes you only care about the current directory</li><li>Leading directory path is stripped off of everything</li></ul></div><div class="step" step="55" data-x="88000" data-y="0"><pre class="highlight "># In httpd.conf
RewriteRule ^/images/(.+)\.jpg /images/$1.png

# In .htaccess in root dir
RewriteBase /
RewriteRule ^images/(.+)\.jpg images/$1.png

# In .htaccess in images/
RewriteBase /images/
RewriteRule ^(.+)\.jpg $1.png</pre></div><div class="step" step="56" data-x="89600" data-y="0"><h1 id="rewritecond">RewriteCond</h1><ul><li>Additional condition on a rewrite</li><li>Can consult any variable, not just REQUEST_URI</li><li>Can evaluate arbitrary expressions</li></ul></div><div class="step" step="57" data-x="91200" data-y="0"><img src="images/syntax_rewritecond.png" alt="" width="" height=""></img></div><div class="step" step="58" data-x="92800" data-y="0"><pre class="highlight ">RewriteCond %{REMOTE_ADDR} ^10\.2\.
RewriteRule (.*) http://intranet.example.com$1</pre></div><div class="step" step="59" data-x="94400" data-y="0"><h1 id="backreferences">Backreferences</h1><pre class="highlight ">RewriteCond %{HTTP_HOST} (.*)
RewriteRule ^/(.*) /sites/%1/$1</pre></div><div class="step" step="60" data-x="96000" data-y="0"><h1 id="flow">Flow</h1><img src="images/rewrite_backreferences.png" alt="" width="" height=""></img></div><div class="step" step="61" data-x="97600" data-y="0"><h1 id="f-and-d">-f and -d</h1><ul><li>-f - Is it a file?</li><li>-d - Is it a directory?</li></ul><pre class="highlight "># If it doesn't map to a on-disk resource ...
RewriteRule /var/www%{REQUEST_URI} !-f
RewriteRule /var/www%{REQUEST_URI} !-d

RewriteRule ^ /index.php [PT,L]
# index.php can examine $_SERVER['REQUEST_URI']
# for the original request</pre></div><div class="step" step="62" data-x="99200" data-y="0"><h1 id="others">Others</h1><ul><li>-s - is a file with non-zero size</li><li>-U - resolves to a valid URL - This is SLOW</li><li>-x - is an executable file</li></ul></div><div class="step" step="63" data-x="100800" data-y="0"><h1 id="la-u">LA-U</h1><ul><li>Look-ahead for a variable that hasn't been set yet</li><li>For example, use this for auth user, which is set <em>after</em> rewrite phase</li></ul><pre class="highlight ">RewriteCond %{LA-U:REMOTE_USER} (.+)
RewriteRule (.*) http://people.example.org/%1/$1   [R,L]</pre></div><div class="step" step="64" data-x="102400" data-y="0"><h1 id="expresions">Expresions</h1><ul><li>Evaluate arbitrary logical expressions</li></ul><pre class="highlight ">RewriteCond expr "! %{HTTP_REFERER} \
    -strmatch '*://%{HTTP_HOST}/*'"
RewriteRule ^/images - [F]</pre></div><div class="step" step="65" data-x="104000" data-y="0"><h1 id="rewritemap">RewriteMap</h1><ul><li>External map which can be used in a RewriteRule</li><li>1-1 mapping</li><li>DB lookup</li><li>Some kind of programmatic thingy</li></ul></div><div class="step" step="66" data-x="105600" data-y="0"><h1 id="id12">RewriteMap</h1><pre class="highlight ">RewriteMap MapName MapType:MapSource</pre><p>eg.</p><pre class="highlight ">RewriteMap examplemap txt:/path/to/file/map.txt
RewriteRule ^/ex/(.*) ${examplemap:$1}</pre></div><div class="step" step="67" data-x="107200" data-y="0"><pre class="highlight ">RewriteMap product2id \
    txt:/etc/apache2/productmap.txt
RewriteRule ^/product/(.*) \
     /prods.php?id=${product2id:$1|NOTFOUND} [PT]</pre><p>where productmap.txt looks like</p><pre class="highlight ">##
## productmap.txt - Product to ID map file
##

television 993
stereo 198
fishingrod 043
basketball 418
telephone 328</pre></div><div class="step" step="68" data-x="108800" data-y="0"><h1 id="other-map-types">Other map types</h1><dl><dt>txt</dt><dd><p>Plain text maps</p></dd><dt>rnd</dt><dd><p>Randomized Plain Text</p></dd><dt>dbm</dt><dd><p>DBM Hash File</p></dd></dl><pre class="highlight ">httxt2dbm -i rewritemap.txt -o rewritemap.dbm</pre></div><div class="step" step="69" data-x="110400" data-y="0"><dl><dt>int</dt><dd><p>Internal Function</p></dd><dt>prg</dt><dd><p>External Rewriting Program</p></dd><dt>dbd or fastdbd</dt><dd><p>SQL Query</p></dd></dl><p><em>examples in bonus slides at the end, if we have extra time</em></p></div><div class="step" step="70" data-x="112000" data-y="0"><p>Logging - 2.2 and earlier</p><pre class="highlight ">RewriteLog /var/log/httpd/rewrite.log
RewriteLogLevel 9</pre><p>Then ...</p><pre class="highlight ">tail -f /var/log/httpd/rewrite.log</pre></div><div class="step" step="71" data-x="113600" data-y="0"><p>Logging - 2.4 and later</p><pre class="highlight ">ErrorLog /var/log/httpd/error.log
LogLevel warn rewrite:trace6</pre><p>Then ...</p><pre class="highlight ">tail -f /var/log/httpd/error.log | grep rewrite</pre></div><div class="step" step="72" data-x="115200" data-y="0"><h1 id="finis">Finis</h1><p>Email: <a href="mailto:rbowen@apache.org">rbowen@apache.org</a></p><p>Twitter: @rbowen</p><p>Slides: <a href="http://tm3.org/rewritescale">http://tm3.org/rewritescale</a> and at <a href="https://github.com/rbowen/presentations">https://github.com/rbowen/presentations</a></p></div><div class="step" step="73" data-x="116800" data-y="0"><h1 id="bonus-slides">Bonus Slides</h1><ul><li>RewriteMap examples</li><li>Rewrite recipes</li><li>If, ElseIf, Else syntax</li></ul></div><div class="step" step="74" data-x="118400" data-y="0"><h1 id="rnd">rnd</h1><pre class="highlight ">##
## map.txt -- rewriting map
##

static www1|www2|www3|www4
dynamic www5|www6</pre></div><div class="step" step="75" data-x="120000" data-y="0"><h1 id="id13">rnd</h1><pre class="highlight ">RewriteMap servers rnd:/path/to/file/map.txt

RewriteRule ^/(.*\.(png|gif|jpg)) http://${servers:static}/$1 [NC,P,L]
RewriteRule ^/(.*) http://${servers:dynamic}/$1 [P,L]</pre></div><div class="step" step="76" data-x="121600" data-y="0"><h1 id="int">int</h1><pre class="highlight ">RewriteMap lc int:tolower
RewriteRule (.*?[A-Z]+.*) ${lc:$1} [R]</pre></div><div class="step" step="77" data-x="123200" data-y="0"><h1 id="prg">prg</h1><pre class="highlight ">RewriteMap d2u prg:/www/bin/dash2under.pl
RewriteRule - ${d2u:%{REQUEST_URI}}</pre><pre class="highlight ">#!/usr/bin/perl
$| = 1; # Turn off I/O buffering
while (&lt;STDIN&gt;) {
    s/-/_/g; # Replace dashes with underscores
    print $_;
}</pre></div><div class="step" step="78" data-x="124800" data-y="0"><h1 id="dbd">dbd</h1><pre class="highlight ">RewriteMap myquery \
    "fastdbd:SELECT destination FROM rewrite WHERE source = %s"</pre></div><div class="step" step="79" data-x="126400" data-y="0"><h1 id="rewrite-recipes">Rewrite Recipes</h1></div><div class="step" step="80" data-x="128000" data-y="0"><pre class="highlight ">RewriteEngine on

#   first try to find it in dir1/...
#   ...and if found stop and be happy:
RewriteCond         %{DOCUMENT_ROOT}/dir1/%{REQUEST_URI}  -f
RewriteRule  ^(.+)  %{DOCUMENT_ROOT}/dir1/$1  [L]

#   second try to find it in dir2/...
#   ...and if found stop and be happy:
RewriteCond         %{DOCUMENT_ROOT}/dir2/%{REQUEST_URI}  -f
RewriteRule  ^(.+)  %{DOCUMENT_ROOT}/dir2/$1  [L]

#   else go on for other Alias or ScriptAlias directives,
#   etc.
RewriteRule   ^  -  [PT]</pre></div><div class="step" step="81" data-x="129600" data-y="0"><pre class="highlight ">&lt;Directory /var/www/my_blog&gt;
  RewriteBase /my_blog

  RewriteCond /var/www/my_blog/%{REQUEST_FILENAME} !-f
  RewriteCond /var/www/my_blog/%{REQUEST_FILENAME} !-d
  RewriteRule ^ index.php [PT]
&lt;/Directory&gt;</pre><p>Or ...</p><pre class="highlight ">&lt;Directory /var/www/my_blog&gt;
  FallbackResource index.php
&lt;/Directory&gt;</pre></div><div class="step" step="82" data-x="131200" data-y="0"><pre class="highlight ">RewriteEngine on
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !example.com [NC]
RewriteRule \.(gif|jpg|png)$ - [F]</pre><p>or ...</p><pre class="highlight ">RewriteEngine on
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !example.com [NC]
RewriteRule \.(gif|jpg|png)$ /images/goaway.gif [R,L]</pre></div><div class="step" step="83" data-x="132800" data-y="0"><h1 id="if-else-syntax">If/Else syntax</h1><pre class="highlight ">&lt;If "$req{Host} != 'www.wooga.com'"&gt;
    RedirectMatch (.*) http://www.wooga.com$1
&lt;/If&gt;</pre></div><div class="step" step="84" data-x="134400" data-y="0"><pre class="highlight "># Images should be from local pages
# (Prevent image "hotlinking")
&lt;FilesMatch \.(jpg|png|gif)$&gt;
    &lt;If "%{HTTP_HOST} !~ 'example.com'&gt;
        Require all denied
    &lt;/If&gt;
&lt;/FilesMatch&gt;</pre></div><div class="step" step="85" data-x="136000" data-y="0"><h1 id="see-also">See also:</h1><ul><li>mod_macro</li><li>mod_substitute</li></ul></div><div class="step" step="86" data-x="137600" data-y="0"><p>Finis</p></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>